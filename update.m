function newvbus = update(vbus,dx,genlist,loadlist)%%%  This routine forms updates the vector of complex bus%  voltage phasors, vbus, using specified incremental changes%  in certain phase angles and voltage magnitudes, dx.%  %  Arguments: complex bus voltage vector, vbus;%             real vector of incremental changes%               in generator/load bus angles and%               load bus magnitudes, dx;%             real vector of indices of generator buses, genlist;%             real vector of indices of load buses, loadlist;%%  Returns:   updated complex vector of bus voltages%j = sqrt(-1);del=angle(vbus);vmag=abs(vbus);%ngens = length(genlist);nloads =  length(loadlist);index1 = ngens; %del(genlist) = del(genlist) + dx(1:index1);%index2 = index1 +1;index3 = ngens + nloads;%del(loadlist) = del(loadlist) + dx(index2:index3);%index4 = index3 + 1;index5 = ngens + 2*nloads;%vmag(loadlist) = vmag(loadlist) + dx(index4:index5);newvbus = vmag.*exp(j*del);